<!DOCTYPE html>
<html>
<head>
<title>SSH Cert</title>
<meta http-equiv="content-security-policy" content="default-src 'self'; style-src 'unsafe-inline' 'self'; script-src 'unsafe-inline';" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="/.sso/favicon.ico" />
<link rel="stylesheet" type="text/css" href="/.sso/style.css" />
<script>
function onClick() {
  const key = document.getElementById('key').value;
  fetch(window.location, {
    method: 'POST',
    headers: {
      'x-csrf-check': 1,
      'content-type': 'text/plain',
    },
    body: key,
  })
  .then(resp => {
    if (resp.status !== 200) {
      return resp.text().then(t => resp.status + ': ' + t);
    }
    return resp.text();
  })
  .then(cert => document.getElementById('cert').textContent = cert);
}
</script>
</head>
<body>
{{ if ne .Email "" }}
<div style="position: absolute; right: 1rem; top: 1rem;">
{{.Email}} <a href="/.sso/logout" class="button">Logout</a>
</div>
{{ end }}
<div id="message" style="text-align: left;">
<p>Enter your SSH <em>Public</em> Key to receive a Certificate with principal: [<b>{{.Email}}</b>] signed by this CA:</p>
<div style="margin: 1rem; word-break: break-all; user-select: all; text-align: left;">
{{.CA}}
</div>
<textarea id="key" style="height: 5em; width: 50vw;" placeholder="Enter your SSH Public Key"></textarea>
<button onclick="onClick();">Get Certificate</button>
<div id="cert" style="margin: 1rem; word-break: break-all; user-select: all;"></div>
</div>
</body>
</html>
