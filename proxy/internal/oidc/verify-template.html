<!DOCTYPE html>
<html>
<head>
<title tkey="oidc-device-auth-title">Device Authorization</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.1" />
<link rel="stylesheet" type="text/css" href="/.sso/style.css" />
<script src="/.sso/common.js"></script>
<style>
h1 {
  font-size: 150%;
}
button {
  margin-top: 5rem;
  cursor: pointer;
  padding: 0.75em;
  font-weight: bold;
  border-radius: 1em;
}
button:hover {
  background-color: lightgray;
}
#sso {
  position: absolute;
  right: 1rem;
  top: 1rem;
}
#usercode {
  text-align: center;
}
</style>
<script>
function respond(answer) {
  fetch(window.location, {
    method: 'POST',
    headers: {
      'content-type': 'application/x-www-form-urlencoded',
    },
    body: 'approve='+(answer===true?'true':'false')+'&user_code='+encodeURIComponent(document.getElementById('usercode').value),
  })
  .then(async resp => {
    if (resp.status !== 200) {
      const t = await resp.text();
      throw new Error(resp.status + ': ' + t);
    }
    return resp.text();
  })
  .then(r => {
    document.getElementById('message').textContent = tlsProxy.translate(r.trim());
    window.close();
  })
  .catch(r => {
    document.getElementById('message').textContent = r;
  });
}
</script>
</head>
<body>
<div id="sso">
{{.Email}} <a onclick="tlsProxy.logout();" tkey="logout-button" class="button">Logout</a>
</div>
<div id="message">
<h1 tkey="oidc-device-auth-request">Device Authorization Request</h1>
<div tkey="oidc-verify-device-auth">Please verify that the device requesting authorization is in your possession and that the User Code matches.</div>
<div><input id="usercode" type="text" tkey="oidc-user-code" name="user_code" value="{{.UserCode}}" placeholder="User Code" /></div>
<div><a class="button" tkey="oidc-deny-button" onclick="respond(false);">Deny</a> <a class="button" tkey="oidc-approve-button" onclick="respond(true);">Approve</a></div>
</body>
</html>
